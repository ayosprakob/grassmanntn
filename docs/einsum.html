<!DOCTYPE html>
<html  lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1"><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

      <title>einsum()</title>
    
          <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
          <link rel="stylesheet" href="_static/theme.css " type="text/css" />
      
      <!-- sphinx script_files -->
        <script src="_static/documentation_options.js?v=2709fde1"></script>
        <script src="_static/doctools.js?v=888ff710"></script>
        <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
        <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

      
      <!-- bundled in js (rollup iife) -->
      <!-- <script src="_static/theme-vendors.js"></script> -->
      <script src="_static/theme.js" defer></script>
    
  <link rel="index" title="Index" href="genindex.html" />
  <link rel="search" title="Search" href="search.html" />
  <link rel="next" title="join_legs() and split_legs()" href="joinsplit.html" />
  <link rel="prev" title="dense and sparse" href="densesparse.html" /> 
  </head>

  <body>
    <div id="app">
    <div class="theme-container" :class="pageClasses"><navbar @toggle-sidebar="toggleSidebar">
  <router-link to="index.html" class="home-link">
    
      <span class="site-name">grassmanntn</span>
    
  </router-link>

  <div class="links">
    <navlinks class="can-hide">



    </navlinks>
  </div>
</navbar>

      
      <div class="sidebar-mask" @click="toggleSidebar(false)">
      </div>
        <sidebar @toggle-sidebar="toggleSidebar">
          
          <navlinks>
            



            
          </navlinks><div id="searchbox" class="searchbox" role="search">
  <div class="caption"><span class="caption-text">Quick search</span>
    <div class="searchformwrapper">
      <form class="search" action="search.html" method="get">
        <input type="text" name="q" />
        <input type="submit" value="Search" />
        <input type="hidden" name="check_keywords" value="yes" />
        <input type="hidden" name="area" value="default" />
      </form>
    </div>
  </div>
</div><div class="sidebar-links" role="navigation" aria-label="main navigation">
  
    <div class="sidebar-group">
      <p class="caption">
        <span class="caption-text"><a href="index.html#example-tensor-renormalization-group">Contents:</a></span>
      </p>
      <ul class="current">
        
          <li class="toctree-l1 ">
            
              <a href="densesparse.html" class="reference internal ">dense and sparse</a>
            

            
          </li>

        
          <li class="toctree-l1 current">
            
              <a href="#" class="reference internal current">einsum()</a>
            

            
              <ul>
                
                  <li class="toctree-l2"><a href="#description" class="reference internal">Description</a></li>
                
                  <li class="toctree-l2"><a href="#algorithm" class="reference internal">Algorithm</a></li>
                
                  <li class="toctree-l2"><a href="#examples" class="reference internal">Examples</a></li>
                
              </ul>
            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="joinsplit.html" class="reference internal ">join_legs() and split_legs()</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="hconjugate.html" class="reference internal ">hconjugate()</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="decomposition.html" class="reference internal ">svd() and eig()</a>
            

            
          </li>

        
      </ul>
    </div>
  
</div>
        </sidebar>

      <page>
          <div class="body-header" role="navigation" aria-label="navigation">
  
  <ul class="breadcrumbs">
    <li><a href="index.html">Docs</a> &raquo;</li>
    
    <li>einsum()</li>
  </ul>
  

  <ul class="page-nav">
  <li class="prev">
    <a href="densesparse.html"
       title="previous chapter">← dense and sparse</a>
  </li>
  <li class="next">
    <a href="joinsplit.html"
       title="next chapter">join_legs() and split_legs() →</a>
  </li>
</ul>
  
</div>
<hr>
          <div class="content" role="main" v-pre>
            
  <section id="einsum">
<h1>einsum()<a class="headerlink" href="#einsum" title="Link to this heading">¶</a></h1>
<dl class="py function">
<dt class="sig sig-object py" id="grassmanntn.einsum">
<span class="sig-prename descclassname"><span class="pre">grassmanntn.</span></span><span class="sig-name descname"><span class="pre">einsum</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">subscripts</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">operands</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#grassmanntn.einsum" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<p>Perform the Grassmann tensor contraction of the operands in the Einstein summation notation, where each pair of indices with the same character are contracted.</p>
<p><strong>Parameters:</strong></p>
<ul>
<li><p><strong>subscripts:</strong> <code class="docutils literal notranslate"><span class="pre">str</span></code></p>
<p>Specify the subscripts of the operands, each separated by a comma indicator <code class="docutils literal notranslate"><span class="pre">,</span></code>, in the Einstein summation notation. Unless it is a complete summation, the subscript of the result <em>must be specified</em> after the indicator <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code>. See the note below for the acceptable subscripts.</p>
</li>
<li><p><strong>operands:</strong> <em>grassmann_tensor</em></p>
<p>Grassmann tensors (<code class="docutils literal notranslate"><span class="pre">dense</span></code> or <code class="docutils literal notranslate"><span class="pre">sparse</span></code> types) in the same order as specified in <code class="docutils literal notranslate"><span class="pre">subscripts</span></code>. Each operand can be of different types, but they will be converted to the same type as the first operand.</p>
</li>
</ul>
<p><strong>Returns:</strong></p>
<ul class="simple">
<li><p><strong>out</strong> (<em>scalar</em> or <em>grassmann_tensor</em>):
The result of the contraction with the same object type as the first operand. If it is a complete contraction, the function returns a scalar (<code class="docutils literal notranslate"><span class="pre">float</span></code>, or <code class="docutils literal notranslate"><span class="pre">complex</span></code>).</p></li>
</ul>
<section id="description">
<h2>Description<a class="headerlink" href="#description" title="Link to this heading">¶</a></h2>
<p>The function <code class="docutils literal notranslate"><span class="pre">einsum</span></code> aims to simplify the calculation of Grassmann tensor contraction. The argument <code class="docutils literal notranslate"><span class="pre">subscripts</span></code>, which is a list of indices of each operand separated by commas, tells the program which pair of indices are to be contracted, as well as the arrangement of the resulting object’s indices. For example, the contraction</p>
<div class="math notranslate nohighlight">
\[\mathcal{C}_{\psi_1\bar\psi_2\bar\psi_3}
=\int_{\bar\phi\phi}\mathcal{A}_{\psi_1\phi\bar\psi_3}\mathcal{B}_{\bar\psi_2\bar\phi}\]</div>
<p>is represented by the subscripts <code class="docutils literal notranslate"><span class="pre">'ilk,jl-&gt;ijk'</span></code> where <code class="docutils literal notranslate"><span class="pre">i</span></code>, <code class="docutils literal notranslate"><span class="pre">j</span></code>, <code class="docutils literal notranslate"><span class="pre">k</span></code>, and <code class="docutils literal notranslate"><span class="pre">l</span></code> represent <span class="math notranslate nohighlight">\(\psi_1\)</span>, <span class="math notranslate nohighlight">\(\psi_2\)</span>, <span class="math notranslate nohighlight">\(\psi_3\)</span>, and <span class="math notranslate nohighlight">\(\phi\)</span>, respectively. There is no ambiguity about the conjugacy of the indices since it is already specified by the attribute <code class="docutils literal notranslate"><span class="pre">statistics</span></code> of each operand. The fermion <span class="math notranslate nohighlight">\(\phi\)</span> is contracted, so the symbol <code class="docutils literal notranslate"><span class="pre">l</span></code> comes in a pair in the subscripts. Available characters for the indices include Latin characters <code class="docutils literal notranslate"><span class="pre">a-z</span></code> and <code class="docutils literal notranslate"><span class="pre">A-Z</span></code>, as well as Greek characters α-Ω. It is also possible to use numbered indices by adding a number (of any length) after a character. For example, the string <code class="docutils literal notranslate"><span class="pre">'i1ai3,i2a-&gt;i1i2i3'</span></code> is equivalent to <code class="docutils literal notranslate"><span class="pre">'ilk,jl-&gt;ijk'</span></code>. Spaces can also be placed anywhere to improve readability; e.g. <code class="docutils literal notranslate"><span class="pre">'i1</span> <span class="pre">a</span> <span class="pre">i3,</span> <span class="pre">i2</span> <span class="pre">a</span> <span class="pre">-&gt;</span> <span class="pre">i1</span> <span class="pre">i2</span> <span class="pre">i3'</span></code>. The function <code class="docutils literal notranslate"><span class="pre">einsum</span></code> only supports up to 86 unique indices (including the numbered indices) in one operation.</p>
</section>
<section id="algorithm">
<h2>Algorithm<a class="headerlink" href="#algorithm" title="Link to this heading">¶</a></h2>
<p>The Grassmann tensor contraction differs from the usual contraction in that we have to include the sign factor tensor in the summation. For example, the contraction</p>
<div class="math notranslate nohighlight">
\[\mathcal{C}_{\psi_1\bar\psi_2\bar\psi_3}
=\int_{\bar\phi\phi}\mathcal{A}_{\psi_1\phi\bar\psi_3}\mathcal{B}_{\bar\psi_2\bar\phi}\]</div>
<p>is equivalent to the sum</p>
<div class="math notranslate nohighlight">
\[C_{IJK}=\sum_{J,K,L}A_{ILK}B_{JL}s_{JKL}\]</div>
<p>of the coefficient tensor, where</p>
<div class="math notranslate nohighlight">
\[s_{JKL}=(-)^{p(L)(p(J)+p(K))+p(J)p(K)}\sigma_L\]</div>
<p>is the sign factor tensor. Thus, the task is to compute the sign tensor from a given <code class="docutils literal notranslate"><span class="pre">subscripts</span></code> string and operands’ <code class="docutils literal notranslate"><span class="pre">statistics</span></code>.</p>
<p>The sign factor tensor is computed in three steps: pre-contraction <span class="math notranslate nohighlight">\(s_1\)</span>, mid-contraction <span class="math notranslate nohighlight">\(s_2\)</span>, and post-contraction step <span class="math notranslate nohighlight">\(s_3\)</span>. The pre-contraction tensor comes from the permutation of the fermions so that, for each pair of fermions to be contracted, the conjugated fermion is moved to the right of the non-conjugated counterpart. For example,</p>
<div class="math notranslate nohighlight">
\[\psi_1^I{\color{Magenta}\phi^L}\bar\psi_3^K\;\bar\psi_2^J{\color{Magenta}\bar\phi^L}
\;\rightarrow\;
\psi_1^I{\color{Magenta}\phi^L\bar\phi^L}\bar\psi_3^K\bar\psi_2^J\times (-)^{p(L)(p(J)+p(K))}\]</div>
<p>gives</p>
<div class="math notranslate nohighlight">
\[(s_1)_{JKL} = (-)^{p(L)(p(J)+p(K))}.\]</div>
<p>For each pair of contracted fermions, we have to include another set of contraction sign factors <span class="math notranslate nohighlight">\(\sigma_I\)</span> (see (eq:sigma_factor)); e.g.,</p>
<div class="math notranslate nohighlight">
\[\psi_1^I{\color{Magenta}\phi^L\bar\phi^L}\bar\psi_3^K\bar\psi_2^J
\;\rightarrow\;
\psi_1^I\bar\psi_3^K\bar\psi_2^J\times \sigma_L\]</div>
<p>gives</p>
<div class="math notranslate nohighlight">
\[(s_2)_{L} = \sigma_L.\]</div>
<p>And finally, the post-contraction step, which is the permutation of the fermions into the form specified in <code class="docutils literal notranslate"><span class="pre">subscripts</span></code>, gives another sign factor; e.g.,</p>
<div class="math notranslate nohighlight">
\[\psi_1^I{\color{Magenta}\bar\psi_3^K\bar\psi_2^J}
\;\rightarrow\;
\psi_1^I{\color{Magenta}\bar\psi_2^J\bar\psi_3^K}\times (-)^{p(J)p(K)}\]</div>
<p>gives</p>
<div class="math notranslate nohighlight">
\[(s_3)_{JK} = (-)^{p(J)p(K)}.\]</div>
<p>The three sign factors are then combined as</p>
<div class="math notranslate nohighlight">
\[s_{JKL} = (s_1)_{JKL}(s_2)_{L}(s_3)_{JK},\]</div>
<p>which is then used to perform the contraction.</p>
</section>
<section id="examples">
<h2>Examples<a class="headerlink" href="#examples" title="Link to this heading">¶</a></h2>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>  <span class="o">&gt;&gt;&gt;</span> <span class="kn">import</span> <span class="nn">grassmanntn</span> <span class="k">as</span> <span class="nn">gtn</span>
  <span class="o">&gt;&gt;&gt;</span> <span class="n">A</span> <span class="o">=</span> <span class="n">gtn</span><span class="o">.</span><span class="n">random</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">8</span><span class="p">),</span><span class="n">statistics</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>
  <span class="o">&gt;&gt;&gt;</span> <span class="n">B</span> <span class="o">=</span> <span class="n">gtn</span><span class="o">.</span><span class="n">random</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span><span class="mi">4</span><span class="p">),</span><span class="n">statistics</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>
  <span class="o">&gt;&gt;&gt;</span> <span class="n">C</span> <span class="o">=</span> <span class="n">gtn</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;ilk,jl-&gt;ijk&#39;</span><span class="p">,</span><span class="n">A</span><span class="p">,</span><span class="n">B</span><span class="p">)</span> <span class="c1"># Contraction between A and B.</span>
  <span class="o">&gt;&gt;&gt;</span> <span class="n">C</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;C&quot;</span><span class="p">)</span> <span class="c1"># Show basic information.</span>

      <span class="n">name</span><span class="p">:</span> <span class="n">C</span>
<span class="n">array</span> <span class="nb">type</span><span class="p">:</span> <span class="n">dense</span>
     <span class="n">shape</span><span class="p">:</span> <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
   <span class="n">density</span><span class="p">:</span> <span class="mi">256</span> <span class="o">/</span> <span class="mi">512</span> <span class="o">~</span> <span class="mf">50.0</span> <span class="o">%</span>
<span class="n">statistics</span><span class="p">:</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="nb">format</span><span class="p">:</span> <span class="n">standard</span>
   <span class="n">encoder</span><span class="p">:</span> <span class="n">canonical</span>
    <span class="n">memory</span><span class="p">:</span> <span class="mf">4.18</span> <span class="n">KiB</span>
      <span class="n">norm</span><span class="p">:</span> <span class="mf">8.477345182714446</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">einsum</span></code> function can be used to take the tensor trace:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">T</span> <span class="o">=</span> <span class="n">gtn</span><span class="o">.</span><span class="n">random</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">4</span><span class="p">),</span><span class="n">statistics</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">trT</span> <span class="o">=</span> <span class="n">gtn</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;ijij&#39;</span><span class="p">,</span><span class="n">T</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">trT</span><span class="p">)</span>
<span class="go">-1.506277867139303</span>
</pre></div>
</div>
<p>To take the trace with anti-periodic boundary conditions, the sign factor must be applied to the coefficient manually:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">grassmanntn.param</span> <span class="kn">import</span> <span class="n">gparity</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">dimt</span> <span class="o">=</span> <span class="n">T</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="c1"># Size of the anti-periodic leg</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">S</span><span class="o">=</span><span class="p">[(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">**</span><span class="n">gparity</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">dimt</span><span class="p">)]</span> <span class="c1"># Anti-periodic sign factor</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">T</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;ijkl,j-&gt;ijkl&#39;</span><span class="p">,</span><span class="n">T</span><span class="o">.</span><span class="n">data</span><span class="p">,</span><span class="n">S</span><span class="p">)</span> <span class="c1">#&lt;== This is numpy.einsum!</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">trT</span> <span class="o">=</span> <span class="n">gtn</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;ijij&#39;</span><span class="p">,</span><span class="n">T</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">trT</span><span class="p">)</span> <span class="c1">#Should be different from the periodic trace</span>
<span class="go">1.571951156790323</span>
</pre></div>
</div>
<p>It can also be used to swap the indices:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>  <span class="o">&gt;&gt;&gt;</span> <span class="n">C2</span> <span class="o">=</span> <span class="n">gtn</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;ijk-&gt;jki&#39;</span><span class="p">,</span><span class="n">C</span><span class="p">)</span>
  <span class="o">&gt;&gt;&gt;</span> <span class="n">C2</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;C2&quot;</span><span class="p">)</span>

      <span class="n">name</span><span class="p">:</span> <span class="n">C2</span>
<span class="n">array</span> <span class="nb">type</span><span class="p">:</span> <span class="n">dense</span>
     <span class="n">shape</span><span class="p">:</span> <span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
   <span class="n">density</span><span class="p">:</span> <span class="mi">256</span> <span class="o">/</span> <span class="mi">512</span> <span class="o">~</span> <span class="mf">50.0</span> <span class="o">%</span>
<span class="n">statistics</span><span class="p">:</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="nb">format</span><span class="p">:</span> <span class="n">standard</span>
   <span class="n">encoder</span><span class="p">:</span> <span class="n">canonical</span>
    <span class="n">memory</span><span class="p">:</span> <span class="mf">4.18</span> <span class="n">KiB</span>
      <span class="n">norm</span><span class="p">:</span> <span class="mf">8.477345182714446</span>
</pre></div>
</div>
</section>
</section>


          </div>
          <div class="page-nav">
            <div class="inner"><ul class="page-nav">
  <li class="prev">
    <a href="densesparse.html"
       title="previous chapter">← dense and sparse</a>
  </li>
  <li class="next">
    <a href="joinsplit.html"
       title="next chapter">join_legs() and split_legs() →</a>
  </li>
</ul><div class="footer" role="contentinfo">
      &#169; Copyright 2023, Atis Yosprakob.
    <br>
    Created using <a href="http://sphinx-doc.org/">Sphinx</a> 7.2.3 with <a href="https://github.com/schettino72/sphinx_press_theme">Press Theme</a> 0.8.0.
</div>
            </div>
          </div>
      </page>
    </div></div>
    
    
  </body>
</html>